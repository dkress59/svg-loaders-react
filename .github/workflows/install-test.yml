name: Module Import

on:
    push:
        branches: [ master, feature/workflow ]
    pull_request:
        branches: [ master, feature/workflow ]

jobs:
    test_import:
        runs-on: ubuntu-latest
        env:
            SLT: 'svg-loaders-tester'
            SLR: 'svg-loaders-react'
            WORKDIR: '/home/runner/work/svg-loaders-react/svg-loaders-react'
        steps:
            - uses: actions/checkout@v2
            - uses: actions/setup-node@v2-beta
              with:
                  node-version: '15'
                  check-latest: true

            - name: âš›ï¸ Create React App
              run: >-
                  yarn create react-app ${{env.SLT}} --template typescript &&
                  cd ${{env.SLT}}

            - name: â›“ Copy Source
              run: >-
                  cd $WORKDIR &&
                  mkdir -p $WORKDIR/${{env.SLT}}/node_modules/${{env.SLR}}/src &&
                  cp tsconfig.json ${{env.SLT}}/node_modules/${{env.SLR}}/tsconfig.json &&
                  cp package.json ${{env.SLT}}/node_modules/${{env.SLR}}/package.json &&
                  cp .prettierrc ${{env.SLT}}/node_modules/${{env.SLR}}/.prettierrc &&
                  cp yarn.lock ${{env.SLT}}/node_modules/${{env.SLR}}/yarn.lock &&
                  cp -r src/* ${{env.SLT}}/node_modules/${{env.SLR}}/src

            - name: ðŸ‹ðŸ¼â€â™€ï¸ Build Node Module
              run: >-
                  cd $WORKDIR/${{env.SLT}}/node_modules/${{env.SLR}} &&
                  yarn --pure-lockfile --ignore-scripts &&
                  cd .. && cd ${{env.SLR}} &&
                  yarn build

            - name: ðŸ“¥ Test Module Import
              run: >-
                  cd $WORKDIR &&
                  rm -f ${{env.SLT}}/src/App.ts ${{env.SLT}}/src/App.tsx &&
                  cp test/install.test ${{env.SLT}}/src/App.tsx &&
                  cd ${{env.SLT}} &&
                  yarn build